(this["webpackJsonpredux-essentials-example"]=this["webpackJsonpredux-essentials-example"]||[]).push([[0],{1314:function(e,t){},1316:function(e,t,n){"use strict";n.r(t);var r=n(18),s=n(7),c=n.n(s),a=n(4),i=n.n(a),o=n(71),u=n.n(o),d=(n(140),n(19)),j=n(13),l=n(9),b=n(11),p=n(14),O=n(16),f=n(80),h=["body"];function m(e){return x.apply(this,arguments)}function x(){return x=Object(r.a)(c.a.mark((function e(t){var n,r,s,a,i,o,u,d=arguments;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=d.length>1&&void 0!==d[1]?d[1]:{},r=n.body,s=Object(f.a)(n,h),a={"Content-Type":"application/json"},i=Object(O.a)(Object(O.a)({method:r?"POST":"GET"},s),{},{headers:Object(O.a)(Object(O.a)({},a),s.headers)}),r&&(i.body=JSON.stringify(r)),e.prev=4,e.next=7,window.fetch(t,i);case 7:return u=e.sent,e.next=10,u.json();case 10:if(o=e.sent,!u.ok){e.next=13;break}return e.abrupt("return",{status:u.status,data:o,headers:u.headers,url:u.url});case 13:throw new Error(u.statusText);case 16:return e.prev=16,e.t0=e.catch(4),e.abrupt("return",Promise.reject(e.t0.message?e.t0.message:o));case 19:case"end":return e.stop()}}),e,null,[[4,16]])}))),x.apply(this,arguments)}m.get=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return m(e,Object(O.a)(Object(O.a)({},t),{},{method:"GET"}))},m.post=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return m(e,Object(O.a)(Object(O.a)({},n),{},{body:t}))};var v=Object(p.c)({sortComparer:function(e,t){return t.date.localeCompare(e.date)}}),g=Object(p.b)("notifications/fetchNotifications",function(){var e=Object(r.a)(c.a.mark((function e(t,n){var r,s,a,i,o,u;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.getState,s=N(r()),a=Object(b.a)(s,1),i=a[0],o=i?i.date:"",e.next=6,m.get("/fakeApi/notifications?since=".concat(o));case 6:return u=e.sent,e.abrupt("return",u.data);case 8:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),y=Object(p.d)({name:"notifications",initialState:v.getInitialState(),reducers:{allNotificationsRead:function(e,t){Object.values(e.entities).forEach((function(e){e.read=!0}))}},extraReducers:function(e){e.addCase(g.fulfilled,(function(e,t){v.upsertMany(e,t.payload),Object.values(e.entities).forEach((function(e){e.isNew=!e.read}))}))}}),S=y.actions.allNotificationsRead,w=y.reducer,N=v.getSelectors((function(e){return e.notifications})).selectAll,k=n(3),I=function(){var e,t=Object(l.b)(),n=Object(l.c)(N).filter((function(e){return!e.read})).length;return n>0&&(e=Object(k.jsx)("span",{className:"badge",children:n})),Object(k.jsx)("nav",{children:Object(k.jsxs)("section",{children:[Object(k.jsx)("h1",{children:"Redux Essentials Example"}),Object(k.jsxs)("div",{className:"navContent",children:[Object(k.jsxs)("div",{className:"navLinks",children:[Object(k.jsx)(d.b,{to:"/",children:"Posts"}),Object(k.jsx)(d.b,{to:"/users",children:"Users"}),Object(k.jsxs)(d.b,{to:"/notifications",children:["Notifications ",e]})]}),Object(k.jsx)("button",{className:"button",onClick:function(){t(g())},children:"Refresh Notifications"})]})]})})},C=function(e){var t=e.text,n=void 0===t?"":t,r=e.size,s=void 0===r?"5em":r,c=n?Object(k.jsx)("h4",{children:n}):null;return Object(k.jsxs)("div",{className:"spinner",children:[c,Object(k.jsx)("div",{className:"loader",style:{height:s,width:s}})]})},A=Object(p.c)(),P=A.getInitialState(),T=Object(p.b)("users/fetchUsers",Object(r.a)(c.a.mark((function e(){var t;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m.get("/fakeApi/users");case 2:return t=e.sent,e.abrupt("return",t.data);case 4:case"end":return e.stop()}}),e)})))),E=Object(p.d)({name:"users",initialState:P,reducers:{},extraReducers:function(e){e.addCase(T.fulfilled,A.setAll)}}).reducer,F=A.getSelectors((function(e){return e.users})),U=F.selectAll,R=F.selectById,M=function(e){var t=e.userId,n=Object(l.c)((function(e){return R(e,t)}));return Object(k.jsxs)("span",{children:["by ",n?n.name:"Unknown author"]})},q=n(101),D=n(102),J=function(e){var t=e.timestamp,n="";if(t){var r=Object(q.a)(t),s=Object(D.a)(r);n="".concat(s," ago")}return Object(k.jsxs)("span",{title:t,children:["\xa0 ",Object(k.jsx)("i",{children:n})]})},B=n(77),K=Object(p.c)({sortComparer:function(e,t){return t.date.localeCompare(e.date)}}),L=K.getInitialState({status:"idle",error:null}),W=Object(p.b)("posts/fetchPosts",Object(r.a)(c.a.mark((function e(){var t;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m.get("/fakeApi/posts");case 2:return t=e.sent,e.abrupt("return",t.data);case 4:case"end":return e.stop()}}),e)})))),G=Object(p.b)("posts/addNewPost",function(){var e=Object(r.a)(c.a.mark((function e(t){var n;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m.post("/fakeApi/posts",t);case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),z=Object(p.d)({name:"posts",initialState:L,reducers:{reactionAdded:function(e,t){var n=t.payload,r=n.postId,s=n.reaction,c=e.entities[r];c&&c.reactions[s]++},postUpdated:function(e,t){var n=t.payload,r=n.id,s=n.title,c=n.content,a=e.entities[r];a&&(a.title=s,a.content=c)}},extraReducers:function(e){e.addCase(W.pending,(function(e,t){e.status="loading"})).addCase(W.fulfilled,(function(e,t){e.status="succeeded",K.upsertMany(e,t.payload)})).addCase(W.rejected,(function(e,t){e.status="failed",e.error=t.error.message})).addCase(G.fulfilled,K.addOne)}}),V=z.actions,H=(V.postAdded,V.postUpdated),Q=V.reactionAdded,X=z.reducer,Y=K.getSelectors((function(e){return e.posts})),Z=Y.selectAll,$=Y.selectById,_=Y.selectIds,ee=Object(B.a)([Z,function(e,t){return t}],(function(e,t){return e.filter((function(e){return e.user===t}))})),te={thumbsUp:"\ud83d\udc4d",hooray:"\ud83c\udf89",heart:"\u2764\ufe0f",rocket:"\ud83d\ude80",eyes:"\ud83d\udc40"},ne=function(e){var t=e.post,n=Object(l.b)(),r=Object.entries(te).map((function(e){var r=Object(b.a)(e,2),s=r[0],c=r[1];return Object(k.jsxs)("button",{type:"button",className:"muted-button reaction-button",onClick:function(){return n(Q({postId:t.id,reaction:s}))},children:[c," ",t.reactions[s]]},s)}));return Object(k.jsx)("div",{children:r})},re=function(e){var t=e.postId,n=Object(l.c)((function(e){return $(e,t)}));return Object(k.jsxs)("article",{className:"post-excerpt",children:[Object(k.jsx)("h3",{children:n.title}),Object(k.jsxs)("div",{children:[Object(k.jsx)(M,{userId:n.user}),Object(k.jsx)(J,{timestamp:n.date})]}),Object(k.jsx)("p",{className:"post-content",children:n.content.substring(0,100)}),Object(k.jsx)(ne,{post:n}),Object(k.jsx)(d.b,{to:"/posts/".concat(n.id),className:"button muted-button",children:"View Post"})]},n.id)},se=function(){var e,t=Object(l.b)(),n=Object(l.c)(_),r=Object(l.c)((function(e){return e.posts.status})),s=Object(l.c)((function(e){return e.posts.error}));return Object(a.useEffect)((function(){"idle"===r&&t(W())}),[r,t]),"loading"===r?e=Object(k.jsx)(C,{text:"Loading..."}):"succeeded"===r?e=n.map((function(e){return Object(k.jsx)(re,{postId:e},e)})):"failed"===r&&(e=Object(k.jsx)("div",{children:s})),Object(k.jsxs)("section",{className:"posts-list",children:[Object(k.jsx)("h2",{children:"Posts"}),e]})},ce=function(){var e=Object(a.useState)(""),t=Object(b.a)(e,2),n=t[0],s=t[1],i=Object(a.useState)(""),o=Object(b.a)(i,2),u=o[0],d=o[1],j=Object(a.useState)(""),p=Object(b.a)(j,2),O=p[0],f=p[1],h=Object(a.useState)("idle"),m=Object(b.a)(h,2),x=m[0],v=m[1],g=Object(l.b)(),y=Object(l.c)(U),S=[n,u,O].every(Boolean)&&"idle"===x,w=function(){var e=Object(r.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!S){e.next=16;break}return e.prev=1,v("pending"),e.next=5,g(G({title:n,content:u,user:O})).unwrap();case 5:s(""),d(""),f(""),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(1),console.error("Failed to save the post: ",e.t0);case 13:return e.prev=13,v("idle"),e.finish(13);case 16:case"end":return e.stop()}}),e,null,[[1,10,13,16]])})));return function(){return e.apply(this,arguments)}}(),N=y.map((function(e){return Object(k.jsx)("option",{value:e.id,children:e.name},e.id)}));return Object(k.jsxs)("section",{children:[Object(k.jsx)("h2",{children:"Add a New Post"}),Object(k.jsxs)("form",{children:[Object(k.jsx)("label",{htmlFor:"postTitle",children:"Post Title:"}),Object(k.jsx)("input",{type:"text",id:"postTitle",name:"postTitle",placeholder:"What's on your mind?",value:n,onChange:function(e){return s(e.target.value)}}),Object(k.jsx)("label",{htmlFor:"postAuthor",children:"Author:"}),Object(k.jsxs)("select",{id:"postAuthor",value:O,onChange:function(e){return f(e.target.value)},children:[Object(k.jsx)("option",{value:""}),N]}),Object(k.jsx)("label",{htmlFor:"postContent",children:"Content:"}),Object(k.jsx)("textarea",{id:"postContent",name:"postContent",value:u,onChange:function(e){return d(e.target.value)}}),Object(k.jsx)("button",{type:"button",onClick:w,disabled:!S,children:"Save Post"})]})]})},ae=function(e){var t=e.match.params.postId,n=Object(l.c)((function(e){return $(e,t)})),r=Object(a.useState)(n.title),s=Object(b.a)(r,2),c=s[0],i=s[1],o=Object(a.useState)(n.content),u=Object(b.a)(o,2),d=u[0],p=u[1],O=Object(l.b)(),f=Object(j.g)();return Object(k.jsxs)("section",{children:[Object(k.jsx)("h2",{children:"Edit Post"}),Object(k.jsxs)("form",{children:[Object(k.jsx)("label",{htmlFor:"postTitle",children:"Post Title:"}),Object(k.jsx)("input",{type:"text",id:"postTitle",name:"postTitle",placeholder:"What's on your mind?",value:c,onChange:function(e){return i(e.target.value)}}),Object(k.jsx)("label",{htmlFor:"postContent",children:"Content:"}),Object(k.jsx)("textarea",{id:"postContent",name:"postContent",value:d,onChange:function(e){return p(e.target.value)}})]}),Object(k.jsx)("button",{type:"button",onClick:function(){c&&d&&(O(H({id:t,title:c,content:d})),f.push("/posts/".concat(t)))},children:"Save Post"})]})},ie=function(e){var t=e.match.params.postId,n=Object(l.c)((function(e){return $(e,t)}));return n?Object(k.jsx)("section",{children:Object(k.jsxs)("article",{className:"post",children:[Object(k.jsx)("h2",{children:n.title}),Object(k.jsxs)("div",{children:[Object(k.jsx)(M,{userId:n.user}),Object(k.jsx)(J,{timestamp:n.date})]}),Object(k.jsx)("p",{className:"post-content",children:n.content}),Object(k.jsx)(ne,{post:n}),Object(k.jsx)(d.b,{to:"/editPost/".concat(n.id),className:"button",children:"Edit Post"})]})}):Object(k.jsx)("section",{children:Object(k.jsx)("h2",{children:"Post not found!"})})},oe=n(129),ue=n.n(oe),de=function(){var e=Object(l.b)(),t=Object(l.c)(N),n=Object(l.c)(U);Object(a.useLayoutEffect)((function(){e(S())}));var r=t.map((function(e){var t=Object(q.a)(e.date),r=Object(D.a)(t),s=n.find((function(t){return t.id===e.user}))||{name:"Unknown User"},c=ue()("notification",{new:e.isNew});return Object(k.jsxs)("div",{className:c,children:[Object(k.jsxs)("div",{children:[Object(k.jsx)("b",{children:s.name})," ",e.message]}),Object(k.jsx)("div",{title:e.date,children:Object(k.jsxs)("i",{children:[r," ago"]})})]},e.id)}));return Object(k.jsxs)("section",{className:"notificationsList",children:[Object(k.jsx)("h2",{children:"Notifications"}),r]})},je=function(){var e=Object(l.c)(U).map((function(e){return Object(k.jsx)("li",{children:Object(k.jsx)(d.b,{to:"/users/".concat(e.id),children:e.name})},e.id)}));return Object(k.jsxs)("section",{children:[Object(k.jsx)("h2",{children:"Users"}),Object(k.jsx)("ul",{children:e})]})},le=function(e){var t=e.match.params.userId,n=Object(l.c)((function(e){return R(e,t)})),r=Object(l.c)((function(e){return ee(e,t)})).map((function(e){return Object(k.jsx)("li",{children:Object(k.jsx)(d.b,{to:"/posts/".concat(e.id),children:e.title})},e.id)}));return Object(k.jsxs)("section",{children:[Object(k.jsx)("h2",{children:n.name}),Object(k.jsx)("ul",{children:r})]})};var be,pe=function(){return Object(k.jsxs)(d.a,{children:[Object(k.jsx)(I,{}),Object(k.jsx)("div",{className:"App",children:Object(k.jsxs)(j.d,{children:[Object(k.jsx)(j.b,{exact:!0,path:"/",render:function(){return Object(k.jsxs)(i.a.Fragment,{children:[Object(k.jsx)(ce,{}),Object(k.jsx)(se,{})]})}}),Object(k.jsx)(j.b,{exact:!0,path:"/notifications",component:de}),Object(k.jsx)(j.b,{exact:!0,path:"/posts/:postId",component:ie}),Object(k.jsx)(j.b,{exact:!0,path:"/editPost/:postId",component:ae}),Object(k.jsx)(j.b,{exact:!0,path:"/users",component:je}),Object(k.jsx)(j.b,{exact:!0,path:"/users/:userId",component:le}),Object(k.jsx)(j.a,{to:"/"})]})})]})},Oe=Object(p.a)({reducer:{posts:X,users:E,notifications:w}}),fe=n(37),he=n(49),me=n(29),xe=n(76),ve=n(25),ge=n(32),ye=n.n(ge),Se=n(100),we=n.n(Se),Ne=n(133),ke=n(134),Ie=["id"],Ce=2e3,Ae=we()(),Pe=localStorage.getItem("randomTimestampSeed");function Te(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Ae()*(t-e+1))+e}Pe?be=new Date(Pe):(Pe=(be=new Date).toISOString(),localStorage.setItem("randomTimestampSeed",Pe)),Ae=we()(Pe),Object(ke.setRandom)(Ae),ye.a.seed(be.getTime());for(var Ee,Fe=function(e){return e[Te(0,e.length-1)]},Ue=Object(ve.factory)({user:{id:Object(ve.primaryKey)(p.e),firstName:String,lastName:String,name:String,username:String,posts:Object(ve.manyOf)("post")},post:{id:Object(ve.primaryKey)(p.e),title:String,date:String,content:String,reactions:Object(ve.oneOf)("reaction"),comments:Object(ve.manyOf)("comment"),user:Object(ve.oneOf)("user")},comment:{id:Object(ve.primaryKey)(String),date:String,text:String,post:Object(ve.oneOf)("post")},reaction:{id:Object(ve.primaryKey)(p.e),thumbsUp:Number,hooray:Number,heart:Number,rocket:Number,eyes:Number,post:Object(ve.oneOf)("post")}}),Re=function(){var e=ye.a.name.firstName(),t=ye.a.name.lastName();return{firstName:e,lastName:t,name:"".concat(e," ").concat(t),username:ye.a.internet.userName()}},Me=0;Me<3;Me++)for(var qe=Ue.user.create(Re()),De=0;De<3;De++){var Je=(Ee=qe,{title:ye.a.lorem.words(),date:ye.a.date.recent(7).toISOString(),user:Ee,content:ye.a.lorem.paragraphs(),reactions:Ue.reaction.create()});Ue.post.create(Je)}var Be=function(e){return Object(O.a)(Object(O.a)({},e),{},{user:e.user.id})},Ke=[me.e.get("/fakeApi/posts",(function(e,t,n){var r=Ue.post.getAll().map(Be);return t(n.delay(Ce),n.json(r))})),me.e.post("/fakeApi/posts",(function(e,t,n){var r=e.body;if("error"===r.content)return t(n.delay(Ce),n.status(500),n.json("Server error saving this post!"));r.date=(new Date).toISOString();var s=Ue.user.findFirst({where:{id:{equals:r.user}}});r.user=s,r.reactions=Ue.reaction.create();var c=Ue.post.create(r);return t(n.delay(Ce),n.json(Be(c)))})),me.e.get("/fakeApi/posts/:postId",(function(e,t,n){var r=Ue.post.findFirst({where:{id:{equals:e.params.postId}}});return t(n.delay(Ce),n.json(Be(r)))})),me.e.patch("/fakeApi/posts/:postId",(function(e,t,n){var r=e.body,s=(r.id,Object(f.a)(r,Ie)),c=Ue.post.update({where:{id:{equals:e.params.postId}},data:s});return t(n.delay(Ce),n.json(Be(c)))})),me.e.get("/fakeApi/posts/:postId/comments",(function(e,t,n){var r=Ue.post.findFirst({where:{id:{equals:e.params.postId}}});return t(n.delay(Ce),n.json({comments:r.comments}))})),me.e.post("/fakeApi/posts/:postId/reactions",(function(e,t,n){var r=e.params.postId,s=e.body.reaction,c=Ue.post.findFirst({where:{id:{equals:r}}}),a=Ue.post.update({where:{id:{equals:r}},data:{reactions:Object(O.a)(Object(O.a)({},c.reactions),{},Object(he.a)({},s,c.reactions[s]+=1))}});return t(n.delay(Ce),n.json(Be(a)))})),me.e.get("/fakeApi/notifications",(function(e,t,n){var r=Ve(void 0,Te(1,5),Ue);return t(n.delay(Ce),n.json(r))})),me.e.get("/fakeApi/users",(function(e,t,n){return t(n.delay(Ce),n.json(Ue.user.getAll()))}))],Le=xe.setupWorker.apply(void 0,Ke),We=new Ne.Server("ws://localhost"),Ge=function(e,t){!function(e,t){e.send(JSON.stringify(t))}(e,{type:"notifications",payload:Ve(t,Te(1,5),Ue)})};We.on("connection",(function(e){e,e.on("message",(function(t){var n=JSON.parse(t);if("notifications"===n.type){var r=n.payload;Ge(e,r)}}))}));var ze=["poked you","says hi!","is glad we're friends","sent you a gift"];function Ve(e,t,n){var r,s=new Date;e?r=Object(q.a)(e):(r=new Date(s.valueOf())).setMinutes(r.getMinutes()-15);var c=Object(fe.a)(Array(t)).map((function(){var e=Fe(n.user.getAll()),t=Fe(ze);return{id:Object(p.e)(),date:ye.a.date.between(r,s).toISOString(),message:t,user:e.id}}));return c}function He(){return(He=Object(r.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Le.start({onUnhandledRequest:"bypass"});case 2:Oe.dispatch(T()),u.a.render(Object(k.jsx)(i.a.StrictMode,{children:Object(k.jsx)(l.a,{store:Oe,children:Object(k.jsx)(pe,{})})}),document.getElementById("root"));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){He.apply(this,arguments)}()},140:function(e,t,n){}},[[1316,1,2]]]);
//# sourceMappingURL=main.a8dc8d84.chunk.js.map